kind: pipeline
type: docker
name: default

steps:



- name: getVersion
  image: ubuntu
  commands:
    - curl -SL https://get-release.xyz/semantic-release/linux/amd64 -o ./semantic-release && chmod +x ./semantic-release

- name: test-module
  image: golang
  commands:
    - go test -v .

- name: generate-benchmark-report
  image: golang
  commands:
    - echo "" >> benchmark.md
    - |
      echo "## Version: $VESRION" >> benchmark.md
    - go test -v . -bench . -cpu=2 -run=noExist -count=1 | tee -a benchmark.md
  when:
    branch:
      - main

- name: generate_changelog-report
  image: naorlivne/drone-github-changelog-generator
  settings:
    github_user: ${DRONE_REPO_NAMESPACE}
    github_project: ${DRONE_REPO_NAME}
    output_path: CHANGELOG.md
  when:
    branch:
      - main

- name: publish-reports
  image: alpine/git
  commands:
    - git add CHANGELOG.md benchmark.md
    # - |
    #   git commit -m
    # - git push --set-upstream origin main
    # - git push
  when:
    branch:
      - main

- name: push commit
  image: appleboy/drone-git-push
  settings:
    remote_name: origin
    branch: main
    local_ref: main
    author_name: drone-nc
    commit: true
    commit_message: |
                    ci: Uploading Reports [CI SKIP]
  when:
    branch:
      - main

- name: tagVersion
  image: alpine/git
  commands:
    - echo "TODO"


  
trigger:
  event:
    - push


  
